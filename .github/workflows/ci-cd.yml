name: Mobile Test Automation CI/CD

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:

jobs:
  build:
    name: Build & Validate
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '11'
          cache: 'maven'

      - name: Validate POM
        run: |
          echo "Validating project structure..."
          mvn validate
          echo "POM validation successful"

      - name: Compile Main Sources
        run: |
          echo "Compiling main source files..."
          mvn clean compile -DskipTests
          echo "Main compilation successful"

      - name: Compile Test Sources
        run: |
          echo "Compiling test source files..."
          mvn test-compile
          echo "Test compilation successful"

      - name: Package (skip tests â€” require real device)
        run: |
          echo "Packaging project..."
          mvn package -DskipTests
          echo "Package built successfully"

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: mobile-test-automation-jar
          path: target/*.jar
          retention-days: 7

      - name: Build Summary
        run: |
          echo "================================================"
          echo "  BUILD SUCCESSFUL"
          echo "================================================"
          echo "  Maven POM      : Validated"
          echo "  Main Sources   : Compiled"
          echo "  Test Sources   : Compiled"
          echo "  Package        : Built"
          echo "  Artifact       : Uploaded"
          echo "------------------------------------------------"
          echo "  Mobile tests require a connected Android device"
          echo "  or emulator. Run locally with: mvn clean test"
          echo "================================================"
